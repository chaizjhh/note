# 周报

## 一周

### 2023/7/25

1. 办理入职手续

### 2023/7/26

1. 下载svn仓库的文档，代码资料，并配置gic-server，gic-server-cloud模块正常运行
2. 依照文档预算单位云内控用户手册操作并理解指标管理，支出管理模块的功能。
3. 查看数据库设计文档，概要设计文档简单理解项目基础以及数据库关系基础。

### 2023/7/27

1. 根据指标，支持管理模块的数据库设计文档和操作手册了解功能流程。

### 2023/7/28

1. 开发终审后同步删除报销数据并调试通过

## 二周

### 2023/7/31

1. 理解需求#64738644【辽宁】报销单-支出项目字段内容的显示可以按人员控制区分
2. 了解原有人员管理，报销单管理的功能

### 2023/8/1

1. 增加全局参数控制终审后同步是否删除报销数据
2. 测试支出项目元素是否影响报销单的权限，结果为无影响
3. 设计人员支出项目表结构，开发人员与支出项目维护需求

### 2023/8/2

1. 开发需求报销单-支出项目字段内容的显示可以按人员控制区分
2. 自测并与前端连调接口，修改出现的bug并解决完成。

### 2023/8/3

1. 完成解析并获取发票回单视图的上传字段，并添加到数据库

### 2023/8/4

1. 完成收入台账的填单时的发票回填的视图字段配置

## 三周

### 2023/8/7

1. 进行需求任务结尾，
2. 代码review

### 2023/8/8

1. 解决云内控演示环境报销单录入选择发票报错的问题，主要修改环境的配置文件将ag-collect-ys的application.yml的eureka.instance.instance-id从spring.application.name改为spring.cloud.client.ip-address；将gic-server-ys的feign.name.ag-collecter的ag-collecter改为ag-collect；

### 2023/8/9

1. fix:修改报销单选择发票时会增加空的出差明细的问题

### 2023/8/10

1. 整理报销相关的异常枚举，采用统一业务异常定义处理，并删除部分无引用代码
2. 修改191环境收入录入（台账）的一般业务收款由于数据类型错误保存失败报错问题，并配置相关的工作流权限
3. 根据工资的业务原型以及相关资料，熟悉理解工资相关的业务。

### 2023/8/11

1. 根据需求讨论的内容设计工资项，工资表相关的表结构设计

## 四周

### 2023/8/14

1. 修改工资业务相关表的设计结构，包括工资项定义表，工资明细表，工资项关联表，工资导入表。
2. 工资项需求接口开发百分之50

### 2023/8/15

1. 修改撤销核算数据接口访问IP地址超时的问题
2. 工资项接口开发100%
3. 修改代码注释优化代码

### 2023/8/16

1. 与前端调试工资项相关接口，修改191环境引起的问题以及代码错误，进度95%，剩余一些小问题
2. 使用mybatis-flex重构Dao转换为Mapper，进度50%。

### 2023/8/17

1. 使用mybatis-flex重构Dao转换为Mapper，进度100%
2. 更换支出，项目，指标的业务异常枚举
3. 修改工资项修改时因null产生的bug
4. 修改工资项更新修改去除判断重复逻辑

### 2023/8/18

1. 开发系统外观配置接口100%，自测完成，接口文档编写完毕
2. 配合前端调试bug，部署191环境问题，测试环境数据生产

### 2023/8/19

1. 修改工资项列表排序根据创建时间排序
2. 报销工资申请单详情查询合计接口开发并自测完成
3. 报销工资申请单详情查询支付信息合计接口开发并自测完成

## 五周

### 2023/8/21

1. 补充1.5.0数据库有关撤销核算数据的脚本
2. 报销工资申请单详情查询支付信息合计接口返回数据改造并自测完成
3. 改造工资项接口，区分系统级和单位级两个页面，改造进度100%，并自测完成，接口文档编写完成。

### 2023/8/22

1. 1.5.0版本同步修改删除核算数据的ip重复问题
2. 查询事前指标接口返回数据增加项目分类字段，并修改sql错误
3. 系统级工作项修改时忽略mybatis的自动忽略tenant_id字段
4. 工资相关的is_deleted的枚举替换修改

### 2023/8/23

1. 整理1.5.1工资相关功能，数据库脚本
2. 生成支付信息，查询工资合计金额去除bill_Id参数
3. 查询工资项列表接口修改查询sql
4. 增加查询工资发放明细接口
5. 与前端连调工作项删除增加系统级标识
6. 工资申请单生成支付信息修改sql，增加处理工资发放单据
7. 前端连调时增加系统外观设置增加查询最新的样式接口
8. 解决北京测试环境的核算数据IP不通的问题

### 2023/8/24

1. 工资项相关后端问题修改完成

    * 工资项删除失败修改区分权限提示语，主要出现在单位级删除系统工作项时拒绝删除并提示无权限。
    * 查询列表条件显示数据错误修改，SQL括号问题
    * 工资项保存时增加统一编码用于工资表关联展示，工资项列表查询SQL列增加编码列
    * 由于统一序列参数获取一直失败，修改工资表统一编码暂时替换为时间序列
2. 打包部署191环境并修改相关环境问题

### 2023/8/25

1. 修改工资相关测试的问题，删除增加关联关系的判断
2. 与同事探讨mybatis-flex部分源码，解决InsertListener的无法注入配置文件属性的问题

## 六周

### 2023/8/29

1. 补充发票回填单的数据库脚本
2. 开发指标给项目提供相关接口并自测完成
3. 排查支出管理，收入审核（台账）的审核时sql重复插入错误数据报错的问题
4. 编写工资项的数据库设计，详细设计文档完成60%

### 2023/8/30

1. 编写工资项的数据库设计，详细设计文档完成100%
2. 排查bug：解决【采购管理 采购申请录入】新增页面，采购预算，单位项目不显示值的问题。
3. 完成与同事连调指标给项目提供的相关接口。

### 2023/8/31

1. 指标给项目提供接口修改查询代码错误
2. 采购预算保存与详情接口修改增加预算项目字段，与前端连调测试，并同步1.5.0版本
3. 添加系统样式的建表脚本到1.5.1版本

### 2023/9/1

1. 阅读工作流相关代码
2. 修改20:31021环境脏数据导致查询工作项失败的问题

## 七周

### 2023/9/4

1. 评审并分析单号生成规则的需求
2. 了解旧的单号生成规则以及单号序列生成方式

### 2023/9/5

1. 确认并分析单号规则生成并应用的需求并设计数据库表以及实现方案
2. 开发单号规则设置的基础保存查询接口，进度20%。

### 2023/9/6

1. 开发单号规则以及单号生成需求，开发进度100%，并完成自测后编写接口文档。
2. 与前端沟通单号规以及单号生成需求，确定数据报文结构后修改完成。
3. 开发单号规则优先级查询，目前先了解之前的单号生成调用的地方，排查后进行修改替换。

### 2023/9/7

1. 完成单号规则优先级应用的开发并自测，目前统计代码调用处待修改的部分代码
2. 完成单号规则保存，查询的连调测试。

### 2023/9/8

1. 梳理单号规则应用过程中需要涉及修改的部分并整理成文档共享。
2. 整理并优化单号出口相关的代码

## 八周

### 2023/9/11

1. feat: 单号获取增加默认单号
2. fix: sonar检测bug修改
3. feat: 单号生成根据表达式的散列值确定

### 2023/9/12

1. fix: 单号规则保存增加校验流水号
2. 分析需求单据关联配置，数据库设计
3. 开发单据关联配置

### 2023/9/13

1. 开发单据关联配置完成并自测，接口文档编辑完成。
2. 配合修改151指标给项目提供接口bug，增加字段

### 2023/9/14

1. 单据关联配置前后端连调完成
2. 单号规则保存时时间项设置为必选

### 2023/9/15

1. 单据关联配置应用代码同步Git分支KF-1.6.0，并优化代码结构。

### 2023/9/18

1. 修改单号的getBillInfo接口参数错误导致单号应用失效的问题
2. 调试并修改单据关联配置的错误，并部署到77环境
3. 了解工作流选型相关的wflow-web，turbo项目的相关文档和代码

### 2023/9/19

1. 了解工作流选型相关的wflow-web，turbo开源项目的相关文档和代码
2. 依据前端数据格式进行数据建模

### 2023/9/20

1. 研究工作流选型的数据结构适配，测试样例数据。
2. 针对工作流选型开发数据适配，进度百分之30

### 2023/9/21

1. 研究工作流选型的数据结构适配，测试样例数据。
2. 针对工作流选型开发数据适配，进度百分之70

### 2023/9/22

1. 验证多个流程案例是否能应用工作流数据结构适配器并修改一些问题。
2. 优化适配器代码执行流程，并编写测试案例。
3. 调试后端turbo的demo的运行流程及数据流转线路以及研究工作流引擎执行器的相关源码

### 2023/9/25

1. 研读工作流turbo的有关子流程相关的源码以及执行流程。

### 2023/9/26

1. 调试工作流turbo的有关子流程相关的源码以及执行流程
2. 针对多实例子流程进行demo进行开发调试

### 2023/9/27

1. 针对多实例子流程进行demo进行开发调试

### 2023/9/28

1. 针对多实例子流程进行demo进行开发调试进度百分之50

### 2023/10/7

1. 针对多实例子流程进行demo进行开发调试进度百分之80
2. 解决子流程提交后主流程状态异常，执行结束的问题

### 2023/10/8

1. 针对多实例子流程进行封装开发
2. 针对多实例子流程进行demo进行开发调试完成
3. 参与工作流相关业务表结构设计讨论
4. 参与工资相关现场问题支持讨论

### 2023/10/9

1. 调试工作流回滚以及子流程回滚代码，确定需要改造的代码逻辑
2. 开发工作流模型适配子流程模型的部分

### 2023/10/10

1. 会签执行器驳回功能开发完成
2. 工作流调用封装开发20%

### 2023/10/11

1. 工作流模型配置优化多分支节点合并到下一节点
2. 参加前后端工作流需求评审
3. 工作流相关代码迁移

### 2023/10/12

1. 流程配置接口封装提取百分之20
2. 与同事沟通工作流运行时的数据运转流程

### 2023/10/13

1. 工作流配置接口新增，修改，部署接口开发完成
2. 工作流配置接口新增，修改，部署验证调试进度50

### 2023/10/16

1. 工作流查询，保存，发布开发完成，
2. 节点分配人员开发完成

### 2023/10/17

1. fix: 修改流程执行器获取时匹配类型错误
2. feat: 提交流程判断是否开始工作流，融合子流程
3. feat: 开启子流程时存储到会签表
4. 调用平台封装用户角色相关方法

### 2023/10/18

1. feat: 部署整合工作流配置代码
2. feat: 回滚至指定节点开发完成
3. feat: 获取流程节点nodekey接口
4. feat: 发布流程判断会签时存储子流程nodekey
5. fix: 回滚指定节点调试修改DAO查询错误

### 2023/10/19

1. fix: 部署流程调整保存主流程人员分配逻辑
2. fix: 创建子流程结束保存会签表调整入库逻辑
3. fix: 提交开启子流程修改nodeInstance错误
4. 测试会签流程逻辑

### 2023/10/20

1. 测试会签流程逻辑错误修改
2. 发布流程接口判断是否需要保存

### 2023/10/21

1. 连续会签流程修改判断逻辑，会签回滚修改会签表状态
2. 保存前端工作流模型映射，删除工作流前置未使用代码
3. 工作流数据库脚本适配pgSql数据库。

### 2023/10/23

1. feat: 工作流封装新增调用方和租户
2. feat: 条件节点处理条件表达式
3. fix: 保存 发布接口更改
4. 工作流配置前后端连调进度20%

### 2023/10/24

1. fix: 工作流根节点部署接口增加保存发起人逻辑
2. fix: 工作流保存发布配置接口调试bug修改
3. fix: 工作流模型查询接口解决嵌套问题
4. feat: gic-turbo发布私服设置
5. 协助测试工作流集成报销测试，解决测试问题。
6. 工作流配置前后端连调进度80%

### 2023/10/25

1. feat: 查询流程节点信息接口
2. feat: 回滚到指定节点，判断传过来的节点 是否在已审核的节点中
3. feat: assignType枚举替换；nodeKey生成与前端统一
4. 工作流配置前后端连调进度90%
5. 协助测试工作流集成报销测试，解决测试问题。

### 2023/10/26

1. 会签处理部门信息完成
2. 协助测试预算申请单流程
3. 工作流配置前后端连调进度完成
4. 开发工作流审批日志，进度百分之50。

### 2023/10/27

1. feat: 工作流配置节点存储视图数据
2. feat: 工作流节点日志
3. feat: 工作流查询当前人已办节点视图信息
4. feat: 视图解析类型错误解决 回滚存储视图
5. 协助测试工作流流程正向反向测试。

### 2023/10/28

1. 修正子流程判断是否开始的判断条件
2. feat: 审批节点的审批权限增加code字段
3. feat: 查询节点视图信息接口
4. feat: 发起节点保存角色信息
5. feat: 查询视图信息接口优化适配
6. feat: 查询节点视图信息接口修改字段名称
7. 判断工作流是否含有阻断异常
8. feat: import无用引入优化

### 2023/10/30

1. feat: 开发查询下一节点是否为终审节点
2. 测试并验证退回到指定节点
3. 部署77测试环境

### 2023/10/31

1. 节点关联视图逻辑更改
2. 增加节点自动通过，驳回审批自动跳过参数
3. 查询下一节点是否为终审节点，修改判断逻辑
4. 子流程执行完成时更新会签表状态为COMPLETED，并进行测试修改未生效问题
5. feat: 子流程回滚至主时更新会签节点下所包含子流程状态

### 2023/11/1

1. 节点关联视图逻辑更改，去除formPerms校验
2. 测试会签后终审节点驳回流程，并讨论流程错误的解决方案
3. 针对会签后终审节点驳回流程错误的解决方案进行测试

### 2023/11/2

1. feat: 待处理日志节点去除错误操作人
2. 子流程回滚测试以及执行器回滚逻辑调整，增加执行器注释
3. feat: 工作流流程测试接口

### 2023/11/3

1. 工作流节点保存视图去除无用代码
2. feat: 工作流节点视图保存接口返回视图组ID
3. 工作流节点视图改造开发进度百分之50

### 2023/11/4

1. feat: 工作流节点配置修改保存视图组ID
2. feat: 工作流查询发起节点视图
3. feat: 工作流节点配置复制视图修改新增视图关系逻辑
4. feat: 工作流查询发起节点视图 修改模型节点判断逻辑
5. feat: 解决增加工作量回退参数缺少

### 2023/11/7

1. feat: 工作流日志审批意见判空处理
2. fix: 流程模型适配多条件分支
3. feat: 工作流发起节点取消判断指定人发起权限

### 2023/11/08

1. 工作流保存处理单据层级继承问题
2. feat: 工作流查询视图接口拆分
3. 开发环境打包以及部署测试

### 2023/11/09

1. feat: 工作流节点日志精确定位并去除连续rollback节点日志
2. feat: 工作流节点日志连续回滚过滤节点校验

### 2023/11/10

1. feat: 工作流保存配置时标记视图组使用状态
2. feat: 节点废弃视图清理
3. feat: 增加待办数据逻辑删除接口

### 2023/11/11

1. feat: 工作流清除测试类
2. 单号规则根据系统设置单据优先级获取

### 2023/11/13

1. 单号根据单据类型优先级查询，完成
2. 工作流模型回显数据结构设计完成

### 2023/11/14

1. 完成验证工作流代办逻辑删除，
2. feat: 工作流撤销节点名称取上一节点名称，开发并验证完成
3. feat: 工作流审批通过默认通过改为同意
4. 测试并完成验证流程图预览渲染的数据结构
5. 开发流程图预览，进度30

### 2023/11/15

1. feat: 工作流退回到指定节点过滤条件网关
2. 工作流预览流程图开发测试完成，待调试
3. 测试会签流程

### 2023/11/16

1. 工作流会签撤销退回处理获取待处理节点为空
2. 工作流会签多实例执行器逻辑优化
3. 工作流流程预览接口
4. feat: 工作流会签子流程跨节点退回处理SQL的ID多个问题

### 2023/11/17

1. feat: 工作流日志TaskID校验
2. 测试会签流程的场景，解决相关节点回退错误问题
3. feat: 工作流会签处理子流程不完全回退
4. feat: 工作流预览接口提供节点的连接关系

### 2023/11/20

1. 规划流程预测接口的执行逻辑、设计方案以及工时统计
2. 开发流程预测接口
3. 配合会签测试解决BUG

### 2023/11/21

1. 开发流程预测接口，进度百分之80
2. 测试并讨论会签日志的展示以及数据正确性
3. 测试会签日志

### 2023/11/22

1. feat: 工作流流程预测接口
2. feat: 工作流流程预测修正已处理节点数据
3. 测试流程预测接口数据
4. 修改工作流日志会签方案

### 2023/11/23

1. feat: 工作流turbo整理代码
2. feat: 工作流会签表实时更新时间
3. 连调并测试工作流会签日志

### 2023/11/24

1. 开发工作流预测接口的审批人权限控制，进度50%

### 2023/11/25

1. feat: 工作流流程预测接口过滤审批权限
2. 测试工作流流程预测接口
3. 增加普通视图重置为公共视图接口

### 2023/11/29

1. feat: 工作流流程预测，发起节点处理中时取制单人名称

### 2023/12/1

1. feat: 工作流流程预测，增加会签节点信息

### 2023/12/4

1. feat: 业务删除接口同步删除工作流前置数据
2. 开发工作流预览接口的增加审核意见，进度百分之20

### 2023/12/5

1. feat: 业务删除接口同步删除工作流前置数据
2. feat: 工作流预览接口增加审核意见
3. feat: 业务删除接口同步删除工作流前置数据 解决构造注入失败
4. 测试并优化/getEleRelation接口的缓存实现

### 2023/12/7

1. fix: 工作流预览获取审批日志增加实例数据结构错误校验
2. 优化代办页面的代办配置查询接口，修改为批量查询匹配代办配置

### 2023/12/8

1. feat: 代办列表页接口/workflowPending/queryPendingList查询效率优化
2. fix: /workflowPending/queryPendingList 修改节点数据为空转换错误

### 2023/12/11

1. fix: /workflowPending/queryPendingList 查询代办代码重构优化
2. 解决现场获取session失败导致首页咨询设置失败的问题

### 2023/12/12

1. fix: /workflowPending/queryPendingList 重构查询工作项列表代码，调整公共代码
2. fix: /workflowPending/queryPendingList 重构查询工作项列表代码，调整解析摘要

### 2023/12/13

1. 排查视图查询线程中断报错问题
2. 测试查询我的工作项功能接口是否正确

### 2023/12/14

1. fix: 解决代办配置优化查询后的处理逻辑错误

### 2023/12/15

1. 排查项目结项申报录入查询代办事项单据号显示为空的问题

### 2023/12/18

1. 分析工作流审核节点配置审核要素需求
2. 完成审核要素表结构设计，基础类构建，进度20%

### 2023/12/19

1. 开发工作室配置审核节点要素并自测完成
2. 讨论分析流程结束后是否支持退回的技术方案

### 2023/12/20

1. fix: 工作流保存时更新以及审核页查询审批要素
2. fix: 工作流保存时更新，修改发布解析报错
3. fix: 工作流日志以及预览接口增加审批要素返回

### 2023/12/21

1. feat: MapUtils支持是否忽略NULL
2. fix: 工作流配置审批要素接口 保存修改BUG
3. fix: 工作流审核页查询审批要素更换查询方式
4. fix: 工作流配置审批要素接口-修改删除数据BUG

### 2023/12/22

1. fix: 工作流配置审批要素接口-保存时使用雪花ID
2. fix: 工作流配置审批要素接口-保存时修改新增顺序
3. fix: 工作流配置审批要素接口-查询接口 修改IN排序
4. fix: 积木报表增加工作流审核要素，并测试

### 2023/12/23

1. fix: 积木报表工作流审核日志去重，审批要素去除NULL
2. 取消修改报表审批日志同一个人连续审批多次进行合并问题

### 2023/12/25

1. fix: 打印的文档，审核流程区域隐藏经办人

### 2023/12/26

1. 梳理需求抄送节点抄送表单内联系人的技术方案
2. 开发需求抄送节点选择表单内联系人进度百分之20

### 2023/12/27

1. feat: 工作流抄送节点抄送表单内联系人，自测
2. fix: 工作流消息模版查询单据代办配置修改session字段错误
3. fix: 报销提交工作流单据数据修改为由前端参数替换getBill()查询

### 2023/12/28

1. 与前端连调测试工作流抄送节点抄送表单内联系人，进度百分之70
2. 梳理工作流前置数据表收集代码逻辑，整理被退回已退回需求

### 2023/12/29

1. feat: 工作流条件节点增加条件模式，可选自定义表达式
2. 修复60开发环境无法访问的问题
3. 测试并部署自定义表达式，抄送节点抄送表单内联系人需求

## 2024

### 2024/1/2

1. 合并工作流抄送表单内联系人，自定义条件代码并进行验证
2. 测试工作流抄送表单内联系人

### 2024/1/3

1. feat: 工作流条件节点自定义表达式测试并修改

### 2024/1/4

1. feat: 工作流抄送通知回调上层API支持USER_CODE
2. 测试工作流抄送通知回调是否正确，并修改回调函数，拆分ID与CODE
3. feat: 工作流回调消息发送修改SQL查询用户ID错误

### 2024/1/5

1. 部署并验证69准生产环境的更换数据库的工作
2. 分析按单位区分获取单号的需求

### 2024/1/6

1. feat: 基础模块单号按单位进行隔离
2. feat: 合同模块单号获取由后端设置，并测试
3. 脚本 -- 2024-01-06 配置单号由单位进行隔离区分，feat: 2024/1/6 增量执行1219脚本
4. feat: 工作流抄送通知回调上层API支持USER_CODE 取消拆分ID与CODE，解决某些业务模块缺少code问题
5. fix: logback编码方式修改为UTF-8，修改.log文件乱码问题

### 2024/1/8

1. 讨论并整理单号规则支持适配流水号多选配置，积木报表日志可定制化展示，以及自定义条件分支表达式执行no such propertiey的设计方案
2. 分析单号规则现有设计方案的代码以及库表结构，整理新方案的数据库表

### 2024/1/9

1. feat: 工作流预测修改判断连续条件展示错误
2. 完成设计单号规则的技术方案

### 2024/1/10

1. 排查工作流模型条件层级太深处理失败无法保存的问题
2. feat: 工作流模型数据结构解析深度报错修改，修改连线错误

### 2024/1/11

1. feat: 工作流模型数据结构解析深度报错修改，并进行验证流程数据以及单据测试
2. 设计单号规则方案，梳理单号获取逻辑流程

### 2024/1/12

1. 验证流程解析数据以及其他单据，旧单据的简单流程以及复杂流程测试
2. 配合实施打包进行验证工作流解析代码是否会影响系统稳定性
3. 设计单号规则的具体方案，并落地为文档。

### 2024/1/15

1. fix: 工作流数据解析解决多级分支重复解析问题
2. fix: 单号规则每次计算当前单号
3. 完成重新修改单号规则设计方案

### 2024/1/16

1. 会议评估单号规则设计方案的可行性，并提出测试要点
2. 重新设计并开发单号规则

### 2024/1/17

1. 开发单号规则，进度百分之30
2. 配合现场排查解决报销单进行流程分支判断时，自定义公式判断指标无法处理的问题

### 2024/1/18

1. 开发单号规则，进度百分之80

### 2024/1/19

1. 单号规则测试进度百分之70
2. 单号旧数据数据迁移进度百分之70

### 2024/1/22

1. 并发测试单号获取，并修改相关测试问题，进度100
2. 数据迁移脚本测试，经开会讨论后续将脚本转为接口执行

### 2024/1/23

1. 开发并验证单号记录数据迁移的代码，进度完成
2. 验证单号数据迁移后数据的正确性，测试单号规则配置及生成

### 2024/1/24

1. 部署70测试环境，部署内容：单号重构优化，单号数据迁移接口，数据脚本
2. 部署后进行验证单号数据迁移，单号并发测试，单号数据完整性及连续性，补充数据表索引

### 2024/1/25

1. 获取单号接口的性能测试，进度100
2. 统计分析工作流审核接口调用时长，了解审核后的前置数据收集代码

### 2024/1/26

1. 熟悉工作流前置表数据收集代码
2. 排查并解决现场相关流程与视图问题

### 2024/1/29

1. 分析工作流前置数据收集代码相关执行流程，并落地为执行流程图
2. 根据arthas提供的接口耗时分析，排查高耗时的原因，主要为

    * 代码复用性差，执行了一些没必要的数据库查询

    * 数据库查询次数大，有涉及到循环查询的代码
    * 前置数据表无索引，根据字段查询率考虑增加索引

### 2024/1/30

1. 修改表单内联系人查询时用户code为字符串时报错fix: 表单内联系人修改支持字符串
2. 流程前置数据收集查询子流程判断会签时改为批量查询

## 2024/1/31

1. fix: 流程前置数据收集代码修改并测试
2. 配合排查指标核销模块的bug

### 2024/2/1

1. 单据流程审核退回耗时分析主要存在以下问题

    * 数据库查询次数太大，平均每次审核需要查询至少40次左右
    * 代码复用性查，有多处涉及到循环查询的逻辑
    * 流程前置数据表缺少索引，缺少主键，查询效率不高
2. 针对代码复用性暂时处理为批量，分析SQL执行计划去增加查询频率高的索引，数据库查询次数涉及到代码执行流程，需要组内讨论，暂未更改
3. 针对流程前置数据收集代码更改进行流程测试

### 2024/2/2

1. 组内讨论分析流程审核前置数据收集的代码执行流程逻辑，考虑重新设计，对流程前置数据收集进行重构
2. 针对流程前置数据收集重构进行业务分析，进度百分之10%，主要考虑一下方面

    * 被退回已退回页签执行可行性
    * 相关代码扩展性
    * 数据流转易用性

### 2024/2/19

1. 分析需求提供审核后显示下一岗审核可行性接口支持
2. 分析原有流程预测的实现代码，根据现有实现梳理实现思路，确保需求实现的单一职责

### 2024/2/20

1. fix: 流程预测人员信息获取失败取消异常处理，改为日志处理，并去除多余逗号
2. 提供移动端流程预测接口支持，并编写接口文档分享
3. 开发审核时显示下一节点接口，进度30%

### 2024/2/21

1. fix: 单号获取增加单号打印日志，排查合同录入因单号配置问题导致单号生成相同的问题
2. 开发审核时显示下一节点信息接口，进度90%

### 2024/2/22

1. 分析代办已办前置数据收集逻辑流程，并开会讨论
2. 配合现场人员排查公式无法生效的问题

### 2024/2/23

1. 分析代办已办前置数据收集逻辑流程

### 2024/2/26

1. 配合部署科信局现场测试环境单号的数据迁移需求
2. 整理工作流前置表数据更新的场景以及状态标识

### 2024/2/27

1. 设计工作流前置数据业务状态标记的处理流程
2. 汇报流程数据前置收集的可行性以及标记一些可能出现的问题

### 2024/2/28

1. 整理119环境并部署审核预测下一审核接口与前端联调测试
2. 审核预测下一接口需求变更为审核后查询当前节点，重新开发新接口去适配前端
3. 开发审核后查询当前节点接口，进度基本完成，待联调测试

### 2024/2/29

1. 审核后查询当前节点接口联调测试基本完成，整理配置信息
2. 开发流程数据收集不同场景状态处理流程，进度百分之 20%

### 2024/3/1

1. feat: 标记节点状态-修改流程
2. feat: 标记节点状态-测试流程节点标记
3. feat: 流程前置数据收集第一轮测试
4. feat: 流程前置数据填充基本信息
5. feat: TaskNodeBo 属性填充租户与操作时间
6. feat: 列表页查询SQL修改测试
7. feat: 修改流程配置多个会签模型时，子流程NodeKey一样的BUG

### 2024/3/4

1. feat: 处理流程终审时标记已办为99
2. feat: 处理子流程相同nodekey被覆盖的问题，并增加注释
3. feat: 会签信息补充主流程nodeKey
4. 依据业务场景测试流程数据前置收集，并修改相关问题

### 2024/3/5

1. feat: 下一岗审核更新为终审更改为获取主流程MAX已办ID
2. feat: 更新已办终审获取处理中节点错误修改
3. feat: 更新已办终审时，会签完成后无法更新上一岗为99, 修改判断依据
4. feat: 判断是否更新99 修改未过滤已审核节点错误
5. fix: 已审核页签只查询已审核数据

### 2024/3/6

1. 整理被退回已退回视图修改脚本
2. 测试并验证脚本是否正确执行，视图页签展示是否正确
3. 排查数据库流程相关数据被删除导致业务数据频繁报错的问题

### 2024/3/7

1. 测试被退回已退回的视图数据库脚本，并验证是否正确

### 2024/3/8

1. 排查并解决指标导入由于SqlSession一级缓存导致获取单号为单个单号的问题
2. 排查并解决指标分解由于隔离级别`required_new`​​新建事务导致事务提交时根据事务ID获取数据库连接为NULL的BUG

### 2024/3/11

1. 测试会签场景下已退回被退回页面的数据正确性

### 2024/3/12

1. 测试会签场景已退回被退回数据是否正确，修复会签两人以上时，或一个连续审批时 caller未处理导致数据错误问题

### 2024/3/13

1. 编写依据合同付款阶段进行判断的条件表达式并进行测试，验证通过
2. 编写公共视图已退回被退回按钮脚本
3. fix: 视图重置时补充重置流程状态

### 2024/3/14

1. 修改并排查视图展示被退回页签缺少提交，审核操作bug
2. 编写提交，修改，审核按钮增加到被退回页签脚本，并验证通过
3. 排查现场环境打印日志错误原因代码，并整理修改方案

### 2024/3/18

1. 打印模板审批日志完善优化开发100%
2. 会议讨论跨节点提交，多角色会签需求，评估影响范围以及开发市场
3. 测试打印模板审批日志完善优化，测试进度50%

### 2024/3/19

1. 回溯工作流现有按人会签流程代码，分析设计按角色会签思路，进度80%

### 2024/3/20

1. 回溯工作流现有按人会签流程代码，分析设计按角色会签思路，进度100%
2. 被退回已退回调整顺序脚本，验证100%

‍
