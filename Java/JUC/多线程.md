关于对多线程的自己的见解
# 1. 线程内存模型

> Java的内存模型JMM (Java Memory Model)

​	JMM主要是为了规定线程和内存之间的一些关系.根据JMM的设计,系统存在一个主内存 (Main Memory), Java中所有的实例变量都存储在主存中, `对于所有线程都是共享的`.

​	实例变量的定义：

​	实例变量是指在**类的声明中，**属性是用变量来表示的。 这种变量就称为实例变量，是在类声明的内部但是在类的其他成员方法之外声明的。 类的每个对象维护它自己的一份实例变量的副本。 实例变量：定义在类中但在任何方法之外。 （New出来的均有初始化）

​	每条线程都有自己的工作内存 (Work Memory), 工作内存由**缓存**和**堆栈**两部分组成。

- ​	**缓存**中存储的是**主存中变量的拷贝**, 需要注意的是, 缓存可能并不和主存同步，也就是缓存中变量的修改可能没有立刻写到主存中；缓存同步是在线程执行完毕后, 才会像主存中同步变量, 这个过程是非常消耗资源的. 例如下面的伪代码 

```java
public class Test{
    int a = 0;
    //这里只写伪代码
    Thread a = new Thread().start();
    Thread b = new Thread().start();
}
```

假设，线程 a 和线程 b 都需要修改实例变量 a 的值，线程 a 先拿到时间片并修改变量 a = 1，此时，线程 a 的任务还没有结束，cpu把时间片分给了线程 b，那么线程 b 在它自己的任务中获取到变量 a 的值是 0。并没有获取到线程 a 修改后的值。当线程 a 执行完自己的任务后，会触发缓存同步。

- ​	**堆栈**中存储的是线程的局部变量，线程之间无法相互直接访问堆栈中的变量。

总结：类的实例变量是多个线程共享的，在并发的情况下会出现线程安全问题。